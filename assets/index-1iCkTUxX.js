const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DvDDNUp_.js","assets/index-CjdIg9UX.js","assets/index-CTCSY1dN.css","assets/parseSignature-Csh4mK-M.js","assets/index-DVBzINNB.js","assets/index-BV8s6ez1.js","assets/index-D48z4Q3O.js"])))=>i.map(i=>d[i]);
import{dJ as D,bM as v,b9 as b,dK as C,cn as I,bh as y,dL as A,dM as h,cN as U}from"./index-CjdIg9UX.js";import{dN as T}from"./index-CjdIg9UX.js";function N(u={}){let f,a,s,r;return D(i=>({id:"baseAccount",name:"Base Account",rdns:"app.base.account",type:"baseAccount",async connect({chainId:t,withCapabilities:e}={}){try{const n=await this.getProvider(),o=(await n.request({method:"eth_requestAccounts",params:[]})).map(d=>v(d));a||(a=this.onAccountsChanged.bind(this),n.on("accountsChanged",a)),s||(s=this.onChainChanged.bind(this),n.on("chainChanged",s)),r||(r=this.onDisconnect.bind(this),n.on("disconnect",r));let c=await this.getChainId();if(t&&c!==t){const d=await this.switchChain({chainId:t}).catch(w=>{if(w.code===y.code)throw w;return{id:c}});c=(d==null?void 0:d.id)??c}return{accounts:e?o.map(d=>({address:d,capabilities:{}})):o,chainId:c}}catch(n){throw/(user closed modal|accounts received is empty|user denied account|request rejected)/i.test(n.message)?new y(n):n}},async disconnect(){const t=await this.getProvider();a&&(t.removeListener("accountsChanged",a),a=void 0),s&&(t.removeListener("chainChanged",s),s=void 0),r&&(t.removeListener("disconnect",r),r=void 0),t.disconnect()},async getAccounts(){return(await(await this.getProvider()).request({method:"eth_accounts"})).map(e=>v(e))},async getChainId(){const e=await(await this.getProvider()).request({method:"eth_chainId"});return Number(e)},async getProvider(){if(!f){const t=(()=>{var o;return typeof u.preference=="string"?{options:u.preference}:{...u.preference,options:((o=u.preference)==null?void 0:o.options)??"all"}})(),{createBaseAccountSDK:e}=await A(async()=>{const{createBaseAccountSDK:o}=await import("./index-DvDDNUp_.js");return{createBaseAccountSDK:o}},__vite__mapDeps([0,1,2,3]));f=e({...u,appChainIds:i.chains.map(o=>o.id),preference:t}).getProvider()}return f},async isAuthorized(){try{return!!(await this.getAccounts()).length}catch{return!1}},async switchChain({addEthereumChainParameter:t,chainId:e}){var c,d,w,_;const n=i.chains.find(l=>l.id===e);if(!n)throw new b(new C);const o=await this.getProvider();try{return await o.request({method:"wallet_switchEthereumChain",params:[{chainId:I(n.id)}]}),n}catch(l){if(l.code===4902)try{let p;t!=null&&t.blockExplorerUrls?p=t.blockExplorerUrls:p=(c=n.blockExplorers)!=null&&c.default.url?[(d=n.blockExplorers)==null?void 0:d.default.url]:[];let g;(w=t==null?void 0:t.rpcUrls)!=null&&w.length?g=t.rpcUrls:g=[((_=n.rpcUrls.default)==null?void 0:_.http[0])??""];const L={blockExplorerUrls:p,chainId:I(e),chainName:(t==null?void 0:t.chainName)??n.name,iconUrls:t==null?void 0:t.iconUrls,nativeCurrency:(t==null?void 0:t.nativeCurrency)??n.nativeCurrency,rpcUrls:g};return await o.request({method:"wallet_addEthereumChain",params:[L]}),n}catch(p){throw new y(p)}throw new b(l)}},onAccountsChanged(t){t.length===0?this.onDisconnect():i.emitter.emit("change",{accounts:t.map(e=>v(e))})},onChainChanged(t){const e=Number(t);i.emitter.emit("change",{chainId:e})},async onDisconnect(t){i.emitter.emit("disconnect");const e=await this.getProvider();a&&(e.removeListener("accountsChanged",a),a=void 0),s&&(e.removeListener("chainChanged",s),s=void 0),r&&(e.removeListener("disconnect",r),r=void 0)}}))}S.type="safe";function S(u={}){const{shimDisconnect:f=!1}=u;let a,s;return D(r=>({id:"safe",name:"Safe",type:S.type,async connect({withCapabilities:i}={}){var o;const t=await this.getProvider();if(!t)throw new h;const e=await this.getAccounts(),n=await this.getChainId();return s||(s=this.onDisconnect.bind(this),t.on("disconnect",s)),f&&await((o=r.storage)==null?void 0:o.removeItem("safe.disconnected")),{accounts:i?e.map(c=>({address:c,capabilities:{}})):e,chainId:n}},async disconnect(){var t;const i=await this.getProvider();if(!i)throw new h;s&&(i.removeListener("disconnect",s),s=void 0),f&&await((t=r.storage)==null?void 0:t.setItem("safe.disconnected",!0))},async getAccounts(){const i=await this.getProvider();if(!i)throw new h;return(await i.request({method:"eth_accounts"})).map(v)},async getProvider(){if(typeof window<"u"&&(window==null?void 0:window.parent)!==window){if(!a){const{default:t}=await A(async()=>{const{default:c}=await import("./index-DVBzINNB.js");return{default:c}},__vite__mapDeps([4,5,1,2])),e=new t(u),n=await U(()=>e.safe.getInfo(),{timeout:u.unstable_getInfoTimeout??10});if(!n)throw new Error("Could not load Safe information");const o=await(async()=>{const c=await A(()=>import("./index-D48z4Q3O.js").then(d=>d.i),__vite__mapDeps([6,1,2,5]));return typeof c.SafeAppProvider!="function"&&typeof c.default.SafeAppProvider=="function"?c.default.SafeAppProvider:c.SafeAppProvider})();a=new o(n,e)}return a}},async getChainId(){const i=await this.getProvider();if(!i)throw new h;return Number(i.chainId)},async isAuthorized(){var i;try{return f&&await((i=r.storage)==null?void 0:i.getItem("safe.disconnected"))?!1:!!(await this.getAccounts()).length}catch{return!1}},onAccountsChanged(){},onChainChanged(){},onDisconnect(){r.emitter.emit("disconnect")}}))}export{N as baseAccount,T as injected,S as safe};
